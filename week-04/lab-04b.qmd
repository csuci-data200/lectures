---
title: "Data 200: Lab 4b"
subtitle: "Extra data wrangling practice including data joins"
author: "Professor Medina"
format: 
  html:
    toc: true
knitr:
  opts_chunk:
    message: false
    warning: false
---

```{r}
#| echo: false
#| message: false
library(tidyverse)
library(janitor)
library(titanic)
library(nycflights13)
options(scipen = 999)
```


```{r}
#| echo: false
#| message: false
lapd <- 
  read_csv("https://csuci-data200.github.io/lectures/data/Police_Payroll.csv") |> 
  clean_names() |> 
  filter(year == 2018) |> 
  select(
    job_class_title,
    employment_type, 
    base_pay
  ) |> 
  mutate(
    employment_type = as.factor(employment_type),
    job_class_title = as.factor(job_class_title),
    base_pay_level = case_when(
      base_pay < 0 ~ "Less than 0", 
      base_pay == 0 ~ "No Income",
      base_pay < 100000 & base_pay > 0 ~ "Between 0 and 100K",
      base_pay > 100000 ~ "Greater than 100K"
    )
  ) 

titanic <- titanic_train

artists <- readxl::read_xlsx("../data/spotify.xlsx", sheet = "artist")
songs <- readxl::read_xlsx("../data/spotify.xlsx", sheet = "top_song")
albums <- readxl::read_xlsx("../data/spotify.xlsx", sheet = "album") |> 
  mutate(album_release_date = lubridate::ymd(album_release_date))
```


# Part 1 - Titanic survival

Answer these questions using the `titanic` data frame. To see documentation of the data try running `?titanic_train` after running the above code chunks.


## Question 1 - Variable Names

Make sure variable names adhere to tidyverse style. 
Do not forget to save the changes to the `titanic` data frame so that you can use cleaner names moving forward.


## Question 2 - Fixing a variable type

The variable `Survived` is the passenger survival indicator, but it is stored as 0's and 1's. Convert the variable R type from integer to logical.


## Question 3 - Subsetting Data

What are the names of passengers who have survived, were male, older than 18 years, embarked Titanic in Cherbourg and were traveling in the first class?


## Question 4 - Visualization

Are there any differences in the amount of fare paid depending on ticket's class? First, second, third? Answer this question with a visual. Are you running into an obstacle? Why do you think it is happening?


## Question 7 - Creating a New Variable

Create a new variable called `child`. If a person is less than 18 years the variable `child` should have a value of `TRUE`, if a person is 18 years old or older than the variable `child` should have a value of `FALSE`. Make sure not to use quotations around TRUE or FALSE. These are values known to R. If you use quotes R would make child be a character variable. If you do not use quotes then it would be a logical variable as it should be.
Count how many children were on board after creating the `child variable`?


## Question 8 - Aggregating Data

Calculate the mean and median `fare` paid? Calculate the mean and median `fare` paid for each passenger class?  


## Question 9

The `nycflights13` package has multiple data frames including `flights` and `weather`. You can put the data into your Environment using the `data()` function e.g. `data(flights)`. Since these data come from a package there is documentation so you can get to know the variables in the documentation (e.g. `?flights`)


## Question 10

Join the two data frames. Try doing this without providing a `by` argument. Make sure to "save" the new data frame that is created by joining two data frames.


## Question 11

How many flights were delayed at the departure point when the temperature was less than 32 degrees?


## Question 12

Before this question, a quick detour. The `temp`  variable has missing values, you will have to ask R to ignore (remove) these missing values if you are to summarize this variable. You can do that by setting `na.rm` argument **inside** the `mean()` function.

e.g.

```{r}
mean(weather$temp)
```

```{r}
summarize(weather, mean(temp))
```

```{r}
mean(weather$temp, na.rm = TRUE)
```

```{r}
summarize(weather, mean(temp, na.rm = TRUE))
```

When a flight was delayed at the departure point, what was the average temperature?  


## Question 13

Which airline had the highest median of `dep_delay`? You will need to also join the `airlines` data frame in order to answer this question. Do not just look airline codes and write down the answer. I want to see it in your data frame at the top of your data frame as the highest median `dep_delay`.
